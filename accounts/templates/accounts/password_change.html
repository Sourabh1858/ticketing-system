{% extends "base.html" %}

{% block content %}
<div id="main-content">
    <h2>Profile</h2>
    <p>Username: {{ user.username }}</p>

    <h3>Change Password</h3>

    <!-- Loader Section -->
    <div id="loader" class="d-none position-fixed top-0 start-0 w-100 h-100 bg-white bg-opacity-75 d-flex justify-content-center align-items-center" style="z-index: 1050;">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <form method="post" onsubmit="showLoader(event)">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-outline-success">Change Password</button>
    </form>
</div>

<!-- Toast for Success Message -->
{% if messages %}
    <div class="toast-container position-fixed top-50 start-50 translate-middle" style="z-index: 1050;">
        {% for message in messages %}
            <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <strong class="me-auto">Password Change</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    {{ message }}
                    <a href="{% url 'accounts:login' %}" class="btn btn-link text-decoration-none">Click here to log in.</a>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}

{% endblock %}

<script>
  // Function to show loader and blur background before form submission
  function showLoader(event) {
      event.preventDefault(); // Prevent the form from submitting immediately
      const loader = document.getElementById('loader');
      const mainContent = document.getElementById('main-content');
      loader.classList.remove('d-none'); // Show the loader
      mainContent.style.filter = 'blur(5px)';  // Apply blur to the background content

      // Simulate form submission with a timeout (remove this if actual AJAX is used)
      setTimeout(function() {
          event.target.submit(); // Submit the form after showing the loader
      }, 500); // Adjust this timeout duration as needed, but ensure itâ€™s a small delay
  }

  // Script to automatically show the toast
  var toastElements = document.querySelectorAll('.toast');
  toastElements.forEach(function(toast) {
      var bsToast = new bootstrap.Toast(toast, { delay: 5000 });  // 5-second delay
      bsToast.show();

      // Remove blur effect once the toast disappears
      toast.addEventListener('hidden.bs.toast', function () {
          const mainContent = document.getElementById('main-content');
          mainContent.style.filter = 'none'; // Remove blur effect after toast disappears
      });
  });
</script>



{% comment %} {% extends "base.html" %}

{% block content %}
    <h2>Profile</h2>
    <p>Username: {{ user.username }}</p>

    <h3>Change Password</h3>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-outline-success">Change Password</button>
{% endblock %} {% endcomment %}